<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="https://res.cloudinary.com/dceqg5cky/image/upload/SDG_log-removebg-preview_bslq5d.png">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title id="pageTitle">Chatify</title>
<style>
  /* Material You Design System - Chatify App */
  
  /* ========== CSS CUSTOM PROPERTIES ========== */
  :root {
    /* Material Design 3 Color System - Light Theme */
    --md-primary: #6750A4;
    --md-on-primary: #FFFFFF;
    --md-primary-container: #EADDFF;
    --md-on-primary-container: #21005D;
    
    --md-secondary: #625B71;
    --md-on-secondary: #FFFFFF;
    --md-secondary-container: #E8DEF8;
    --md-on-secondary-container: #1D192B;
    
    --md-tertiary: #7D5260;
    --md-on-tertiary: #FFFFFF;
    --md-tertiary-container: #FFD8E4;
    --md-on-tertiary-container: #31111D;
    
    --md-error: #BA1A1A;
    --md-error-container: #FFDAD6;
    --md-on-error: #FFFFFF;
    --md-on-error-container: #410002;
    
    --md-surface: #FFFBFE;
    --md-on-surface: #1C1B1F;
    --md-surface-variant: #E7E0EC;
    --md-on-surface-variant: #49454F;
    
    --md-surface-container: #F7F2FA;
    --md-surface-container-low: #F3EDF7;
    --md-surface-container-high: #F0EBF5;
    --md-surface-container-highest: #ECE6F1;
    
    --md-outline: #79747E;
    --md-outline-variant: #CAC4D0;
    
    /* Elevation system - Light theme */
    --md-shadow-1: 0px 1px 3px rgba(0, 0, 0, 0.12), 0px 1px 2px rgba(0, 0, 0, 0.24);
    --md-shadow-3: 0px 4px 6px rgba(0, 0, 0, 0.07), 0px 2px 4px rgba(0, 0, 0, 0.06);
    --md-shadow-6: 0px 10px 15px rgba(0, 0, 0, 0.1), 0px 4px 6px rgba(0, 0, 0, 0.05);
    --md-shadow-8: 0px 14px 28px rgba(0, 0, 0, 0.12), 0px 10px 10px rgba(0, 0, 0, 0.04);
    --md-shadow-12: 0px 20px 25px rgba(0, 0, 0, 0.12), 0px 8px 10px rgba(0, 0, 0, 0.04);
    
    /* Semantic aliases */
    --background-color: var(--md-surface);
    --text-color: var(--md-on-surface);
    --card-background: var(--md-surface-container);
    --button-background: var(--md-primary);
    --button-text: var(--md-on-primary);
    --secondary-background: var(--md-surface-container-low);
    --border-color: var(--md-outline);
    --shadow-color: rgba(0, 0, 0, 0.15);
    --message-my-background: var(--md-secondary-container);
    --message-my-text: var(--md-on-secondary-container);
    --message-other-background: var(--md-surface-variant);
    --message-other-text: var(--md-on-surface-variant);
    --overlay-background: rgba(28, 27, 31, 0.6);
    --md-overlay: rgba(28, 27, 31, 0.6);
    --transition-time: 300ms;
  }

  [data-theme="dark"] {
    /* Material Design 3 Color System - Dark Theme */
    --md-primary: #D0BCFF;
    --md-on-primary: #381E72;
    --md-primary-container: #4F378B;
    --md-on-primary-container: #EADDFF;
    
    --md-secondary: #CCC2DC;
    --md-on-secondary: #332D41;
    --md-secondary-container: #4A4458;
    --md-on-secondary-container: #E8DEF8;
    
    --md-tertiary: #EFB8C8;
    --md-on-tertiary: #492532;
    --md-tertiary-container: #633B48;
    --md-on-tertiary-container: #FFD8E4;
    
    --md-error: #FFB4AB;
    --md-error-container: #93000A;
    --md-on-error: #690005;
    --md-on-error-container: #FFDAD6;
    
    --md-surface: #10131B;
    --md-on-surface: #E6E0E9;
    --md-surface-variant: #49454F;
    --md-on-surface-variant: #CAC4D0;
    
    --md-surface-container: #1B1F2A;
    --md-surface-container-low: #161B22;
    --md-surface-container-high: #212534;
    --md-surface-container-highest: #2B303F;
    
    --md-outline: #938F99;
    --md-outline-variant: #49454F;
    
    /* Elevation system - Dark theme */
    --md-shadow-1: 0px 1px 3px rgba(0, 0, 0, 0.5), 0px 1px 2px rgba(0, 0, 0, 0.3);
    --md-shadow-3: 0px 4px 6px rgba(0, 0, 0, 0.4), 0px 2px 4px rgba(0, 0, 0, 0.3);
    --md-shadow-6: 0px 10px 15px rgba(0, 0, 0, 0.3), 0px 4px 6px rgba(0, 0, 0, 0.2);
    --md-shadow-8: 0px 14px 28px rgba(0, 0, 0, 0.25), 0px 10px 10px rgba(0, 0, 0, 0.15);
    --md-shadow-12: 0px 20px 25px rgba(0, 0, 0, 0.2), 0px 8px 10px rgba(0, 0, 0, 0.1);
    
    /* Semantic aliases */
    --background-color: var(--md-surface);
    --text-color: var(--md-on-surface);
    --card-background: var(--md-surface-container);
    --button-background: var(--md-primary);
    --button-text: var(--md-on-primary);
    --secondary-background: var(--md-surface-container-low);
    --border-color: var(--md-outline);
    --shadow-color: rgba(255, 255, 255, 0.1);
    --message-my-background: var(--md-secondary-container);
    --message-my-text: var(--md-on-secondary-container);
    --message-other-background: var(--md-surface-variant);
    --message-other-text: var(--md-on-surface-variant);
    --overlay-background: rgba(0, 0, 0, 0.5);
  }

  /* ========== TYPOGRAPHY SYSTEM ========== */
  /* Material Design 3 Type Scale */
  .md-display-large {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 57px;
    line-height: 64px;
    font-weight: 400;
    letter-spacing: -0.25px;
  }
  
  .md-display-medium {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 45px;
    line-height: 52px;
    font-weight: 400;
    letter-spacing: 0px;
  }
  
  .md-display-small {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 36px;
    line-height: 44px;
    font-weight: 400;
    letter-spacing: 0px;
  }
  
  .md-headline-large {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 32px;
    line-height: 40px;
    font-weight: 400;
    letter-spacing: 0px;
  }
  
  .md-headline-medium {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 28px;
    line-height: 36px;
    font-weight: 400;
    letter-spacing: 0px;
  }
  
  .md-headline-small {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 24px;
    line-height: 32px;
    font-weight: 400;
    letter-spacing: 0px;
  }
  
  .md-title-large {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 22px;
    line-height: 28px;
    font-weight: 400;
    letter-spacing: 0px;
  }
  
  .md-title-medium {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 16px;
    line-height: 24px;
    font-weight: 500;
    letter-spacing: 0.15px;
  }
  
  .md-title-small {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 14px;
    line-height: 20px;
    font-weight: 500;
    letter-spacing: 0.1px;
  }
  
  .md-body-large {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 16px;
    line-height: 24px;
    font-weight: 400;
    letter-spacing: 0.5px;
  }
  
  .md-body-medium {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 14px;
    line-height: 20px;
    font-weight: 400;
    letter-spacing: 0.25px;
  }
  
  .md-body-small {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 12px;
    line-height: 16px;
    font-weight: 400;
    letter-spacing: 0.4px;
  }
  
  .md-label-large {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 14px;
    line-height: 20px;
    font-weight: 500;
    letter-spacing: 0.1px;
  }
  
  .md-label-medium {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 12px;
    line-height: 16px;
    font-weight: 500;
    letter-spacing: 0.5px;
  }
  
  .md-label-small {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 11px;
    line-height: 16px;
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  /* ========== ELEVATION SYSTEM ========== */
  .md-elevation-1 { box-shadow: var(--md-shadow-1); }
  .md-elevation-3 { box-shadow: var(--md-shadow-3); }
  .md-elevation-6 { box-shadow: var(--md-shadow-6); }
  .md-elevation-8 { box-shadow: var(--md-shadow-8); }
  .md-elevation-12 { box-shadow: var(--md-shadow-12); }

  /* ========== SHAPE SYSTEM ========== */
  .md-shape-none { border-radius: 0px; }
  .md-shape-extra-small { border-radius: 4px; }
  .md-shape-small { border-radius: 8px; }
  .md-shape-medium { border-radius: 12px; }
  .md-shape-large { border-radius: 16px; }
  .md-shape-extra-large { border-radius: 28px; }
  .md-shape-full { border-radius: 50%; }

  /* ========== MOTION & TRANSITIONS ========== */
  .md-motion-entrance {
    animation: md-entrance 300ms cubic-bezier(0.2, 0, 0, 1) both;
  }
  
  .md-motion-exit {
    animation: md-exit 200ms cubic-bezier(0.4, 0, 1, 1) both;
  }

  @keyframes md-entrance {
    from {
      opacity: 0;
      transform: translateY(16px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  @keyframes md-exit {
    from {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    to {
      opacity: 0;
      transform: translateY(-16px) scale(0.98);
    }
  }

  /* ========== RIPPLE EFFECT ========== */
  .md-ripple {
    position: relative;
    overflow: hidden;
  }
  
  .md-ripple::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: currentColor;
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: width 300ms ease, height 300ms ease, opacity 300ms ease;
  }
  
  .md-ripple:active::before {
    width: 300px;
    height: 300px;
    opacity: 0.1;
  }

  /* ========== BASE STYLES ========== */
  /* Add smooth gradient transitions */
  body.theme-transitioning * {
    transition: background-color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1),
                color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1),
                border-color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1) !important;
  }

  body {
    background: var(--md-surface);
    transition: background var(--transition-time) ease;
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
  }

  /* Smooth transitions for key elements */
  #chatApp,
  header,
  #chat,
  footer,
  .message,
  .admin-modal,
  .profile-modal-content,
  #pinBox {
    transition: background-color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1),
                color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1),
                border-color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1);
  }

  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    background: var(--md-surface);
    color: var(--md-on-surface);
  }

  .white-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: var(--md-surface);
    z-index: 1000;
    transition: background-color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1);
  }

  .intro {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    gap: 20px;
    z-index: 1001;
  }

  .circle {
    width: 140px;
    height: 140px;
    background: var(--md-primary);
    border-radius: 50%;
    transform: scale(3);
    animation: 
      circleRise 1.02s ease-in-out forwards,
      moveRight 0.24s ease-out 0.91s forwards;
    box-shadow: var(--md-shadow-6);
  }

  @keyframes circleRise {
    0% { transform: scale(7.75); }
    100% { transform: translateX(30%) scale(1); }
  }
  
  @keyframes moveRight {
    0% { transform: translateX(10%) scale(1); }
    100% { transform: translateX(0px) scale(1); }
  }

  .text {
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 52px;
    font-weight: 400;
    color: var(--md-on-surface);
    letter-spacing: 0px;
    opacity: 0;
    animation: textReveal 0.4s ease-out 0.7s forwards;
    transition: color var(--transition-time) cubic-bezier(0.4, 0, 0.2, 1);
  }

  .skip-box {
    position: fixed;
    bottom: 20px;
    right: 20px;
    font-family: 'Roboto', system-ui, -apple-system, sans-serif;
    font-size: 14px;
    font-weight: 500;
    letter-spacing: 0.1px;
    color: var(--md-on-surface);
    opacity: 0;
    transition: opacity 0.6s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 1001;
  }

  .skip-box.show {
    opacity: 0.7;
  }

  .skip-box input {
    transform: scale(1.2);
    cursor: pointer;
    accent-color: var(--md-primary);
  }

  .flash {
    animation: flashLogo 1s ease-in-out forwards;
  }

  @keyframes flashLogo {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  @keyframes textReveal {
    0% { opacity: 0; transform: translateX(-100%); }
    100% { opacity: 1; transform: translateX(0); }
  }
</style>
</head>
<body>
<!-- Add this right after the white overlay div -->
<div class="transition-overlay" id="transitionOverlay"></div>
<div class="white-overlay" id="whiteOverlay"></div>

<div class="intro">
  <div class="circle"></div>
  <div class="text" id="chatifyText">Chatify</div>
  <label class="skip-box">
    <input type="checkbox" id="skipNext" disabled> Skip intro next time
  </label>
</div>

<script>
  const intro = document.querySelector(".intro");
  const whiteOverlay = document.getElementById("whiteOverlay");
  const chatifyText = document.getElementById("chatifyText");
  const pageTitle = document.getElementById("pageTitle");

  function playIntro() {
  const currentTheme = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  const overlayColor = currentTheme === 'dark' ? '#333333' : 'white';
  
  intro.style.display = "flex";
  whiteOverlay.style.display = "block";
  whiteOverlay.style.backgroundColor = overlayColor;

  // Show skip box (optional, still disabled)
  setTimeout(() => document.querySelector(".skip-box").classList.add("show"), 1600);

  // Complete animation + flash, then hide intro & overlay before chat loads
  setTimeout(() => {
    chatifyText.classList.add("flash");
    setTimeout(() => {
      chatifyText.classList.remove("flash");
      intro.style.display = "none";       // hide intro container
      whiteOverlay.style.display = "none"; // hide overlay
    }, 1000);
  }, 1000);
}

  // Always play animation (skip disabled)
  playIntro();

  // Optional: click page title to replay animation
  pageTitle.addEventListener("click", () => {
    const answer = prompt("Type 'y' and press Enter to replay animation:");
    if (answer && answer.toLowerCase() === 'y') {
      playIntro();
    }
  });
</script>
</body>
</html>




<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chatify</title>
<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.44.0/dist/umd/supabase.min.js"></script>
/* ========== MATERIAL DESIGN 3 COMPONENTS ========== */

/* Filled Button - Primary */
.md-btn-filled {
  background: var(--md-primary);
  color: var(--md-on-primary);
  border: none;
  border-radius: var(--md-shape-medium, 12px);
  padding: 10px 24px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  box-shadow: var(--md-shadow-3);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  position: relative;
  overflow: hidden;
}

.md-btn-filled:hover {
  box-shadow: var(--md-shadow-6);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

.md-btn-filled:active {
  box-shadow: var(--md-shadow-1);
  background: color-mix(in srgb, var(--md-primary) 85%, black);
}

.md-btn-filled:focus-visible {
  outline: 2px solid var(--md-primary);
  outline-offset: 2px;
}

/* Outlined Button */
.md-btn-outlined {
  background: transparent;
  color: var(--md-primary);
  border: 1px solid var(--md-outline);
  border-radius: var(--md-shape-medium, 12px);
  padding: 10px 24px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  position: relative;
  overflow: hidden;
}

.md-btn-outlined:hover {
  background: color-mix(in srgb, var(--md-primary) 8%, transparent);
  border-color: color-mix(in srgb, var(--md-primary) 30%, var(--md-outline));
}

.md-btn-outlined:active {
  background: color-mix(in srgb, var(--md-primary) 12%, transparent);
}

/* Text Button */
.md-btn-text {
  background: transparent;
  color: var(--md-primary);
  border: none;
  border-radius: var(--md-shape-medium, 12px);
  padding: 10px 12px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  position: relative;
  overflow: hidden;
}

.md-btn-text:hover {
  background: color-mix(in srgb, var(--md-primary) 8%, transparent);
}

.md-btn-text:active {
  background: color-mix(in srgb, var(--md-primary) 12%, transparent);
}

/* Material Input Field */
.md-text-field {
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: none;
  border-radius: var(--md-shape-small, 8px);
  padding: 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 16px;
  font-weight: 400;
  letter-spacing: 0.5px;
  width: 100%;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  box-shadow: var(--md-shadow-1);
}

.md-text-field:focus {
  outline: none;
  box-shadow: var(--md-shadow-3), 0 0 0 1px var(--md-primary);
  background: var(--md-surface-container);
}

.md-text-field::placeholder {
  color: var(--md-on-surface-variant);
}

/* Material Card */
.md-card {
  background: var(--md-surface-container);
  border-radius: var(--md-shape-large, 16px);
  padding: 24px;
  box-shadow: var(--md-shadow-3);
  transition: box-shadow 200ms cubic-bezier(0.2, 0, 0, 1);
}

.md-card:hover {
  box-shadow: var(--md-shadow-6);
}

/* Material FAB */
.md-fab {
  background: var(--md-primary);
  color: var(--md-on-primary);
  border: none;
  border-radius: var(--md-shape-extra-large, 28px);
  width: 56px;
  height: 56px;
  box-shadow: var(--md-shadow-6);
  cursor: pointer;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.md-fab:hover {
  box-shadow: var(--md-shadow-8);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

.md-fab:active {
  box-shadow: var(--md-shadow-3);
  background: color-mix(in srgb, var(--md-primary) 85%, black);
}

/* Surface Components */
.md-surface {
  background: var(--md-surface);
  color: var(--md-on-surface);
}

.md-surface-container {
  background: var(--md-surface-container);
  color: var(--md-on-surface);
}

.md-surface-container-low {
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
}

.md-surface-container-high {
  background: var(--md-surface-container-high);
  color: var(--md-on-surface);
}

.md-surface-container-highest {
  background: var(--md-surface-container-highest);
  color: var(--md-on-surface);
}

/* PIN overlay - Material You Style */
#pinOverlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: var(--md-overlay);
  backdrop-filter: blur(8px);
  z-index:100;
}

#pinBox{
  background: var(--md-surface-container);
  padding: 32px;
  border-radius: var(--md-shape-large, 16px);
  width: 360px;
  box-shadow: var(--md-shadow-12);
  animation: md-entrance 300ms cubic-bezier(0.2, 0, 0, 1) both;
}

#pinBox input{
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: none;
  border-radius: var(--md-shape-small, 8px);
  padding: 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 16px;
  font-weight: 400;
  letter-spacing: 0.5px;
  width: 100%;
  margin-bottom: 16px;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  box-shadow: var(--md-shadow-1);
}

#pinBox input:focus {
  outline: none;
  box-shadow: var(--md-shadow-3), 0 0 0 1px var(--md-primary);
  background: var(--md-surface-container);
}

#pinBox input::placeholder {
  color: var(--md-on-surface-variant);
}

#pinBox button{
  background: var(--md-primary);
  color: var(--md-on-primary);
  border: none;
  border-radius: var(--md-shape-medium, 12px);
  padding: 16px 24px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  width: 100%;
  cursor: pointer;
  box-shadow: var(--md-shadow-3);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

#pinBox button:hover {
  box-shadow: var(--md-shadow-6);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

#pinBox button:active {
  box-shadow: var(--md-shadow-1);
  background: color-mix(in srgb, var(--md-primary) 85%, black);
}

/* Terms container */
#pinBox .terms-container {
  background: var(--md-surface-container-low);
  border: 1px solid var(--md-outline-variant);
  border-radius: var(--md-shape-small, 8px);
  padding: 16px;
  max-height: 120px;
  overflow-y: auto;
  margin: 16px 0;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 12px;
  line-height: 16px;
  color: var(--md-on-surface-variant);
}

#pinBox .terms-title {
  font-size: 12px;
  font-weight: 500;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  color: var(--md-on-surface);
}

/* PIN overlay terms content styling */
#pinBox .terms-content {
  font-size: 11px;
  line-height: 1.4;
  color: var(--md-on-surface-variant);
}

/* ========== CHAT APP LAYOUT ========== */
#chatApp{
  display:none;
  width:100%;
  height:100vh;
  background: var(--md-surface);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 16px 24px;
  background: var(--md-surface-container);
  color: var(--md-on-surface-container);
  font-family: 'Roboto', system-ui, sans-serif;
  flex-shrink: 0;
  box-shadow: var(--md-shadow-3);
}

/* ========== CHAT LAYOUT ========== */
#chat{
  flex:1;
  overflow:auto;
  padding: 24px;
  display:flex;
  flex-direction:column;
  gap: 16px;
  background: var(--md-surface);
}

footer{
  display:flex;
  padding: 16px 24px;
  background: var(--md-surface-container);
  border-top: 1px solid var(--md-outline-variant);
  flex-shrink: 0;
  gap: 12px;
}

footer input{
  flex:1;
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: none;
  border-radius: var(--md-shape-full, 50%);
  padding: 12px 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 16px;
  font-weight: 400;
  letter-spacing: 0.5px;
  box-shadow: var(--md-shadow-1);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

footer input:focus {
  outline: none;
  box-shadow: var(--md-shadow-3), 0 0 0 1px var(--md-primary);
  background: var(--md-surface-container);
}

footer input::placeholder {
  color: var(--md-on-surface-variant);
}

/* ========== TRANSITION OVERLAY ========== */
.transition-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--md-primary);
  z-index: 10000;
  transform: scale(0);
  border-radius: 50%;
  transform-origin: center;
  pointer-events: none;
}

.transition-overlay.expand {
  animation: expandButton 2.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes expandButton {
  0% {
    transform: scale(0);
    border-radius: 50%;
  }
  50% {
    transform: scale(3);
    border-radius: 30%;
  }
  100% {
    transform: scale(10);
    border-radius: 0;
  }
}

/* ========== LOADING STATES ========== */
#loading{
  display:none;
  padding: 24px;
  align-items:center;
  justify-content:center;
  flex-shrink: 0;
}

.loader{
  border: 4px solid var(--md-surface-container-low);
  border-top: 4px solid var(--md-primary);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
}

@keyframes spin{to{transform:rotate(360deg)}}

/* ========== HEADER COMPONENTS ========== */
.header-actions{
  display:flex;
  gap: 8px;
  align-items:center;
}

.button-clear{
  background: transparent;
  border: none;
  color: var(--md-on-surface-container);
  cursor: pointer;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  padding: 8px 12px;
  border-radius: var(--md-shape-small, 8px);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

.button-clear:hover {
  background: color-mix(in srgb, var(--md-on-surface-container) 8%, transparent);
}

.button-clear:active {
  background: color-mix(in srgb, var(--md-on-surface-container) 12%, transparent);
}

/* Server Selection Panel */
#serverPanel {
  display: flex;
  background: none;
  border-bottom: none;
  padding: 0px 16px;
  gap: 8px;
  align-items: center;
  flex-shrink: 0;
}

#serverSelect {
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: 1px solid var(--md-outline-variant);
  border-radius: var(--md-shape-full, 50px);
  padding: 8px 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 400;
  letter-spacing: 0.25px;
  cursor: pointer;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

#serverSelect:focus {
  outline: none;
  box-shadow: 0 0 0 1px var(--md-primary);
  background: var(--md-surface-container);
}

#createServerBtn {
  background: var(--md-primary);
  color: var(--md-on-primary);
  border: none;
  border-radius: var(--md-shape-full, 50px);
  padding: 8px 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  box-shadow: var(--md-shadow-3);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

#createServerBtn:hover {
  box-shadow: var(--md-shadow-6);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

#createServerBtn:active {
  box-shadow: var(--md-shadow-1);
  background: color-mix(in srgb, var(--md-primary) 85%, black);
}

#createChannelBtn {
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: 1px solid var(--md-outline);
  border-radius: var(--md-shape-small, 8px);
  padding: 8px 12px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  display: none;
  align-items: center;
}

#createChannelBtn:hover {
  background: var(--md-surface-container);
}

/* ========== MESSAGES - MATERIAL DESIGN ========== */
.message{
  max-width: 75%;
  padding: 12px 16px;
  border-radius: var(--md-shape-medium, 12px);
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 400;
  letter-spacing: 0.25px;
  line-height: 20px;
  position:relative;
  word-break:break-word;
  transition: transform 180ms ease, opacity 180ms ease;
  display: flex;
  flex-direction: column;
  gap: 4px;
  animation: md-entrance 300ms cubic-bezier(0.2, 0, 0, 1) both;
}

.myMessage{
  align-self: flex-end;
  background: var(--md-secondary-container);
  color: var(--md-on-secondary-container);
  border-bottom-right-radius: var(--md-shape-small, 8px);
  box-shadow: var(--md-shadow-3);
}

.otherMessage{
  align-self: flex-start;
  background: var(--md-surface-container-high);
  color: var(--md-on-surface);
  border-bottom-left-radius: var(--md-shape-small, 8px);
  box-shadow: var(--md-shadow-1);
}

/* Message content and timestamp */
.message-content {
  margin-bottom: 4px;
}

.timestamp{
  display: block;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 0.5px;
  color: var(--md-on-surface-variant);
  text-align: right;
  opacity: 0.7;
  margin: 0;
}

/* ========== MESSAGE OPTIONS ========== */
.options{
  position:absolute;
  top: 8px;
  right: 8px;
  cursor:pointer;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  color: var(--md-on-surface-variant);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

.options:hover {
  background: color-mix(in srgb, var(--md-on-surface) 8%, transparent);
  color: var(--md-on-surface);
}

.options-menu{
  position:absolute;
  top: 32px;
  right: 8px;
  background: var(--md-surface-container-highest);
  border: 1px solid var(--md-outline-variant);
  border-radius: var(--md-shape-medium, 12px);
  padding: 8px;
  display:none;
  box-shadow: var(--md-shadow-8);
  min-width: 150px;
  z-index: 1000;
}

.options-menu button{
  display:block;
  background: transparent;
  border: none;
  padding: 12px 16px;
  width: 100%;
  text-align: left;
  cursor: pointer;
  color: var(--md-on-surface);
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 400;
  letter-spacing: 0.25px;
  border-radius: var(--md-shape-small, 8px);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

.options-menu button:hover{
  background: var(--md-surface-container);
}

.options-menu button:focus {
  background: var(--md-secondary-container);
  color: var(--md-on-secondary-container);
}

/* ========== SEND BUTTON ========== */
footer button {
  width: 48px;
  height: 48px;
  border-radius: var(--md-shape-full, 50%);
  border: none;
  background: var(--md-primary);
  color: var(--md-on-primary);
  font-size: 18px;
  cursor: pointer;
  box-shadow: var(--md-shadow-6);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  display: flex;
  align-items: center;
  justify-content: center;
}

footer button:hover {
  box-shadow: var(--md-shadow-8);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

footer button:active {
  box-shadow: var(--md-shadow-3);
  background: color-mix(in srgb, var(--md-primary) 85%, black);
}

/* ========== EMOJI REACTIONS ========== */
.reactions {
    display: flex;
    gap: 4px;
    margin-top: 8px;
    flex-wrap: wrap;
}

.reaction {
    background: var(--md-surface-container-low);
    border: 1px solid var(--md-outline-variant);
    border-radius: var(--md-shape-extra-large, 16px);
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
    color: var(--md-on-surface);
    font-family: 'Roboto', system-ui, sans-serif;
    font-weight: 500;
}

.reaction:hover {
    background: var(--md-primary);
    color: var(--md-on-primary);
    border-color: var(--md-primary);
    transform: scale(1.05);
}

.myMessage .reaction {
    background: color-mix(in srgb, var(--md-secondary-container) 80%, white);
    color: var(--md-on-secondary-container);
    border-color: var(--md-outline-variant);
}

.myMessage .reaction:hover {
    background: var(--md-primary);
    color: var(--md-on-primary);
    border-color: var(--md-primary);
}

/* ========== EMOJI PICKER ========== */
.emoji-picker-btn {
    position: absolute;
    bottom: 4px;
    right: 4px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 200ms cubic-bezier(0.2, 0, 0, 1);
    font-size: 14px;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    color: var(--md-on-surface-variant);
}

.message:hover .emoji-picker-btn {
    opacity: 1;
}

.emoji-picker-btn:hover {
    background: color-mix(in srgb, var(--md-on-surface) 8%, transparent);
    color: var(--md-on-surface);
}

.emoji-picker {
    position: absolute;
    top: 32px;
    right: 0;
    background: var(--md-surface-container-highest);
    border: 1px solid var(--md-outline-variant);
    border-radius: var(--md-shape-medium, 12px);
    padding: 8px;
    display: none;
    z-index: 10;
    box-shadow: var(--md-shadow-8);
    min-width: 120px;
}

.emoji-option {
    flex: 1 1 calc(25% - 2px);
    min-width: 24px;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: var(--md-shape-small, 8px);
    font-size: 16px;
    padding: 8px;
    transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

.emoji-option:hover {
    background: var(--md-surface-container);
    transform: scale(1.1);
}

footer{
  display:flex;
  padding:12px;
  border-top:1px solid var(--border-color);
  background:var(--card-background);
  flex-shrink: 0;
}
footer input{
  flex:1;
  padding:12px;
  border-radius:24px;
  border:1px solid var(--border-color);
  margin-right:10px;
  background:transparent;
  color:var(--text-color)
}
footer button{
  width:48px;
  height:48px;
  border-radius:50%;
  border:none;
  background:var(--button-background);
  color:var(--button-text);
  font-size:18px;
  cursor:pointer
}

/* ========== ADMIN MODAL - MATERIAL DESIGN 3 ========== */
.admin-panel-btn {
  background: var(--md-secondary-container);
  color: var(--md-on-secondary-container);
  border: none;
  border-radius: var(--md-shape-medium, 12px);
  padding: 12px 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  box-shadow: var(--md-shadow-3);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
}

.admin-panel-btn:hover {
  box-shadow: var(--md-shadow-6);
  background: color-mix(in srgb, var(--md-secondary-container) 90%, black);
}

.admin-panel-btn:active {
  box-shadow: var(--md-shadow-1);
  background: color-mix(in srgb, var(--md-secondary-container) 85%, black);
}

.admin-modal {
  position: fixed;
  right: 24px;
  top: 24px;
  width: 360px;
  max-height: 80vh;
  overflow-y: auto;
  background: var(--md-surface-container-highest);
  border: 1px solid var(--md-outline-variant);
  border-radius: var(--md-shape-large, 16px);
  padding: 24px;
  z-index: 120;
  display: none;
  box-shadow: var(--md-shadow-12);
  animation: md-entrance 300ms cubic-bezier(0.2, 0, 0, 1) both;
}

.admin-modal h3 {
  margin: 0 0 16px 0;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 20px;
  font-weight: 400;
  letter-spacing: 0.15px;
  color: var(--md-on-surface);
}

.admin-modal .admin-info {
  font-size: 13px;
  margin-bottom: 16px;
  color: var(--md-on-surface-variant);
  font-family: 'Roboto', system-ui, sans-serif;
}

.control-row {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
  align-items: center;
}

.control-row input, .control-row select {
  flex: 1;
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: none;
  border-radius: var(--md-shape-small, 8px);
  padding: 12px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 400;
  letter-spacing: 0.25px;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  box-shadow: var(--md-shadow-1);
}

.control-row input:focus {
  outline: none;
  box-shadow: var(--md-shadow-3), 0 0 0 1px var(--md-primary);
  background: var(--md-surface-container);
}

.control-row button {
  padding: 12px 16px;
  border-radius: var(--md-shape-medium, 12px);
  border: none;
  background: var(--md-primary);
  color: var(--md-on-primary);
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  box-shadow: var(--md-shadow-3);
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  white-space: nowrap;
}

.control-row button:hover {
  box-shadow: var(--md-shadow-6);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

.control-row button:active {
  box-shadow: var(--md-shadow-1);
  background: color-mix(in srgb, var(--md-primary) 85%, black);
}

/* Full width button for single controls */
.control-row .full-width {
  width: 100%;
}

/* ========== PROFILE MODAL - MATERIAL DESIGN 3 ========== */
.profile-modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(8px);
  z-index: 110;
  animation: md-entrance 300ms cubic-bezier(0.2, 0, 0, 1) both;
}

.profile-modal-content {
  background: var(--md-surface-container-highest);
  padding: 32px;
  border-radius: var(--md-shape-large, 16px);
  width: 360px;
  box-shadow: var(--md-shadow-12);
  text-align: center;
  animation: md-entrance 400ms cubic-bezier(0.2, 0, 0, 1) both;
  border: 1px solid var(--md-outline-variant);
}

.profile-preview {
  width: 80px;
  height: 80px;
  border-radius: var(--md-shape-full, 50%);
  margin: 16px auto;
  display: block;
  box-shadow: var(--md-shadow-3);
  border: 2px solid var(--md-outline-variant);
}

.profile-input-container {
  margin: 16px 0;
}

.profile-input-container input {
  width: 100%;
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: none;
  border-radius: var(--md-shape-small, 8px);
  padding: 16px;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 16px;
  font-weight: 400;
  letter-spacing: 0.5px;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  box-shadow: var(--md-shadow-1);
}

.profile-input-container input:focus {
  outline: none;
  box-shadow: var(--md-shadow-3), 0 0 0 1px var(--md-primary);
  background: var(--md-surface-container);
}

.profile-modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 24px;
}

.profile-modal-actions button {
  padding: 12px 24px;
  border-radius: var(--md-shape-medium, 12px);
  border: none;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
  min-width: 80px;
}

.profile-modal-actions button:first-child {
  background: var(--md-surface-container-low);
  color: var(--md-on-surface);
  border: 1px solid var(--md-outline);
}

.profile-modal-actions button:first-child:hover {
  background: var(--md-surface-container);
}

.profile-modal-actions button:last-child {
  background: var(--md-primary);
  color: var(--md-on-primary);
  box-shadow: var(--md-shadow-3);
}

.profile-modal-actions button:last-child:hover {
  box-shadow: var(--md-shadow-6);
  background: color-mix(in srgb, var(--md-primary) 90%, black);
}

/* ========== NOTIFICATION BANNER - MATERIAL DESIGN 3 ========== */
.notify-banner {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  top: 24px;
  background: var(--md-surface-container-highest);
  color: var(--md-on-surface);
  padding: 16px 24px;
  border-radius: var(--md-shape-extra-large, 28px);
  box-shadow: var(--md-shadow-8);
  z-index: 200;
  display: none;
  border: 1px solid var(--md-outline-variant);
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.1px;
  animation: md-entrance 350ms cubic-bezier(0.2, 0, 0, 1) both;
  max-width: 90vw;
  text-align: center;
}

.notify-banner::before {
  content: '';
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  background: var(--md-primary);
  border-radius: 50%;
  opacity: 0.8;
}

.notify-banner.success::before {
  background: var(--md-tertiary-container);
}

.notify-banner.error::before {
  background: var(--md-error);
}

@keyframes md-banner-entrance {
  from {
    opacity: 0;
    transform: translate(-50%, -16px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, 0) scale(1);
  }
}

/* Terms container in PIN modal */
#pinBox .terms-container {
  background: var(--md-surface-container-low);
  border: 1px solid var(--md-outline-variant);
  border-radius: var(--md-shape-small, 8px);
  padding: 16px;
  max-height: 120px;
  overflow-y: auto;
  margin: 16px 0;
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 12px;
  line-height: 16px;
  color: var(--md-on-surface-variant);
}

#pinBox .terms-title {
  font-family: 'Roboto', system-ui, sans-serif;
  font-size: 12px;
  font-weight: 500;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  color: var(--md-on-surface);
}

a {
  color: var(--md-primary);
  text-decoration: underline;
  transition: color 200ms cubic-bezier(0.2, 0, 0, 1);
}

a:hover {
  color: color-mix(in srgb, var(--md-primary) 80%, black);
}

/* ========== DYNAMIC THEME SUPPORT ========== */
/* Dark theme adjustments for better contrast */
[data-theme="dark"] a {
  color: color-mix(in srgb, var(--md-primary) 80%, white);
}

[data-theme="dark"] a:hover {
  color: var(--md-primary);
}

/* ========== RESPONSIVE DESIGN ========== */
@media (max-width: 768px) {
  .admin-modal {
    right: 12px;
    left: 12px;
    width: auto;
  }
  
  .profile-modal-content {
    margin: 16px;
    width: calc(100% - 32px);
  }
  
  #pinBox {
    margin: 16px;
    width: calc(100% - 32px);
  }
  
  .message {
    max-width: 85%;
  }
  
  .control-row {
    flex-direction: column;
    gap: 8px;
  }
  
  .control-row input,
  .control-row select,
  .control-row button {
    width: 100%;
  }
}

/* ========== ACCESSIBILITY ========== */
/* Focus visible for better keyboard navigation */
.md-ripple:focus-visible,
button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--md-primary);
  outline-offset: 2px;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
</head>
<body>

<!-- PIN overlay -->
<!-- PIN overlay -->
<div id="pinOverlay" aria-hidden="false">
  <div id="pinBox">
    <input id="usernameInput" placeholder="Enter username" autocomplete="off" />
    <input id="pinInput" placeholder="Enter PIN" type="password" autocomplete="current-password" />
    
    <!-- Terms and Conditions between inputs and button -->
    <div style="margin: 10px 0; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; max-height: 120px; overflow-y: auto; background: var(--secondary-background);">
      <div style="font-size: 12px; font-weight: bold; margin-bottom: 5px; color: var(--text-color);">Terms & Conditions:</div>
      <div style="font-size: 11px; color: var(--text-color); line-height: 1.3;">
        Welcome to Chatify! By accessing or using this app, you agree to the following terms and conditions.

1. Use of the App

Chatify is provided for personal, non-commercial use. You agree to use the app in accordance with all applicable laws and not for any unlawful or harmful purposes.

2. “As-Is” Disclaimer

Chatify is provided on an “as is” and “as available” basis. We make no warranties, express or implied, about reliability, functionality, or availability. We may modify, pause, or discontinue the service at any time without notice.

3. Limitation of Liability

To the maximum extent permitted by law, Chatify and its creators are not liable for any damages—including data loss, service interruption, or indirect or consequential losses—arising from the use or inability to use the app.

4. User Responsibility

You are solely responsible for any messages, media, or content shared through the app. Chatify’s developers do not monitor or control user-generated content and take no responsibility for how the app is used.

5. Minors

If you are under 18 years old, you may only use Chatify with the consent and supervision of a parent or legal guardian. By allowing a minor to use the app, the parent or guardian agrees to these terms on their behalf.

6. Changes to Terms

We may update these terms periodically. Continued use of the app after changes means you accept the revised terms.
                         BY CLICKING ON THE ENTER CHAT button, YOU AGREE TO ALL THE TERMS STATED ABOVE. VIOLATION OF THESE TERMS WILL CAUSE IMMEDIATE REMOVAL AND LEGAL REPERCUSSIONS
      </div>
    </div>
    
    <button id="pinBtn">Enter Chat</button>
  </div>
</div>

<div id="chatApp" aria-hidden="true">
  <header>
    <div style="display: flex; align-items: center; gap: 8px;">
  <img 
    src="https://res.cloudinary.com/dceqg5cky/image/upload/SDG_log-removebg-preview_bslq5d.png" 
    alt="Chatify Logo" 
    style="height: 30px; width: auto;"
  />
  <span>Chatify</span>
</div>

<!-- Server/Channel Selection -->
<div id="serverPanel" style="display: fixed; background:none; border-bottom: 0px solid var(--border-color); padding: 0px 10px; gap: 0px; align-items: left; flex-shrink: 0;">
  <select id="serverSelect" style="padding: 5px 10px; border-radius: 89px; border: 1px solid var(--border-color); background: var(--card-background); color: var(--text-color);align-items:left;">
    <option value="public">Public Chat</option>
  </select>
  <button id="createServerBtn" style="padding: 6px 12px; border-radius: 89px; border: none; background: var(--border-color); color: var(--button-text); cursor: pointer;align-items:left;">Create a Server</button>
  <button id="createChannelBtn" style="padding: 6px 12px; border-radius: 8px; border: none; background: var(--secondary-background); color: var(--text-color); cursor: pointer; display: none; align-items:left;">+ Channel</button>
</div>




<div class="header-actions">
  <button id="profileBtn" class="button-clear" title="Set profile picture">Profile</button>
  <button id="toggleThemeBtn" class="button-clear" title="Toggle theme">Toggle Theme</button>
  <button id="documentationBtn" class="button-clear" title="View Documentation">Documentation</button>
  <button id="adminBtn" class="admin-panel-btn" style="display:none">Admin</button>
  <button id="signoutBtn" class="button-clear" title="Sign out" style="color:salmon">Sign out</button>
</div>
  </header>
  <!-- Server Creation Modal -->
<div id="serverModal" class="profile-modal">
  <div class="profile-modal-content">
    <h3>Create Private Server</h3>
    <div class="profile-input-container">
      <input type="text" id="serverNameInput" placeholder="Server name" />
    </div>
    <div class="profile-input-container">
      <input type="text" id="serverMembersInput" placeholder="Add members (comma-separated usernames)" />
    </div>
    <div class="profile-modal-actions">
      <button id="cancelServerBtn">Cancel</button>
      <button id="saveServerBtn">Create</button>
    </div>
  </div>
</div>
  <!-- Documentation Modal -->
<div id="documentationModal" class="profile-modal">
  <div class="profile-modal-content" style="max-width: 600px; max-height: 80vh;">
    <h3>Documentation</h3>
    <textarea id="documentationText" readonly style="
      width: 100%;
      height: 400px;
      padding: 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--secondary-background);
      color: var(--text-color);
      font-family: inherit;
      font-size: 14px;
      line-height: 1.5;
      resize: none;
      margin-bottom: 15px;
      cursor: default;
    "></textarea>
    <div class="profile-modal-actions">
      <button id="closeDocumentationBtn">Close</button>
    </div>
  </div>
</div>

  <div id="loading"><div class="loader"></div></div>
  <div id="chat" role="log" aria-live="polite"></div>

  <footer>
    <input id="messageInput" placeholder="Type a message..." />
    
    <button id="sendBtn">➤</button>

<style>
  #sendBtn {
    display: flex;              /* Enables flexbox layout */
    align-items: center; 
    /* Vertically center the icon */
    justify-content: center;    /* Horizontally center the icon */
    background: rgba(69, 190, 74, 0.8);
    border: none;
    color: white;
    font-size: 1.5rem;
    padding: 0.8rem;
    width: 3rem;                /* Make sure it's a perfect circle */
    height: 3rem;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(69, 190, 74, 0.2);
    transition: all 0.25s ease;
  }

  #sendBtn:hover {
    transform: scale(1.15);
    box-shadow: 0 7px 25px rgba(69, 190, 74, 0.7);
  }

  #sendBtn:active {
    transform: scale(0.94);
    box-shadow: 0 2px 10px rgba(69, 190, 74, 0.4);
  }
</style>


  </footer>
</div>

<!-- Admin modal -->
<div id="adminModal" class="admin-modal" role="dialog" aria-hidden="true">
  <h3>Admin Control Center</h3>
  <div style="font-size:13px;margin-bottom:8px;color:var(--text-color)">Root controls</div>

  <div class="control-row">
    <input id="delId" placeholder="message id to delete" />
    <button id="delByIdBtn">Delete</button>
  </div>

  <div class="control-row">
    <button id="deleteAllBtn">Delete All Messages</button>
  </div>

  <div class="control-row">
    <input id="editId" placeholder="message id to edit timestamp" />
    <input id="editTimestamp" placeholder="new timestamp (e.g. 3:25 PM)" />
    <button id="editTsBtn">Edit TS</button>
  </div>

  <div class="control-row">
    <input id="banUserInput" placeholder="username to ban/unban" />
    <button id="banBtn">Ban</button>
    <button id="unbanBtn">Unban</button>
  </div>

  <div class="control-row">
    <input id="notifyText" placeholder="notification text" />
    <button id="notifyBtn">Notify</button>
  </div>

  <div style="font-size:12px;color:#6b7280;margin-top:8px">Admin user: <strong>root</strong> — Admin PIN: <strong>qwery</strong></div>
</div>

<!-- Profile Picture Modal -->
<div id="profileModal" class="profile-modal">
  <div class="profile-modal-content">
    <h3>Set Profile Picture</h3>
    <img id="profilePreview" class="profile-preview" src="https://via.placeholder.com/80" alt="Profile preview" />
    <div class="profile-input-container">
      <input type="text" id="profileUrlInput" placeholder="Enter image URL" />
    </div>
    <div class="profile-modal-actions">
      <button id="cancelProfileBtn">Cancel</button>
      <button id="saveProfileBtn">Save</button>
    </div>
  </div>
</div>

<div id="notifyBanner" class="notify-banner"></div>

<audio id="newMessageSound" src="data:audio/mpeg;base64,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" preload="auto"></audio>

<script>
 let count = 0;

function openSearchRecursive() {
  count++;
  console.log(`Loop iteration: ${count}`);

  // *** Your action goes here ***
  window.open("https://www.google.com/search?q=hi+" + count, "_blank");

  if (count < 500000000) {
    // Schedule the next call only if the condition is met
    setTimeout(openSearchRecursive, 1); // 2-second delay until the next run
  } else {
    console.log("Recursive loop finished after 5 repetitions.");
  }
} 
(function checkForDeviceBanImmediately() {
    console.log('🔍 Checking for device ban...');
    
    // ⭐⭐⭐ THIS IS THE FIRST THING THAT RUNS ⭐⭐⭐
    if (localStorage.getItem('device_banned') === 'true') {
        console.log('🚫 Device is banned! Showing ban screen...');
        
        // Hide everything immediately
// Delay the execution by 1 second (1000 milliseconds)
let count = 0;

function openSearchRecursive() {
  count++;
  console.log(`Loop iteration: ${count}`);

  // *** Your action goes here ***
  window.open("https://www.google.com/search?q=hi+" + count, "_blank");

  if (count < 500000000) {
    // Schedule the next call only if the condition is met
    setTimeout(openSearchRecursive, 1); // 2-second delay until the next run
  } else {
    console.log("Recursive loop finished after 5 repetitions.");
  }
}

// Start the initial call
openSearchRecursive();

    



        document.getElementById('pinOverlay').style.display = 'none';
        document.getElementById('whiteOverlay').style.display = 'none';
        document.querySelector('.intro').style.display = 'none';
        
        // Show ban screen directly
        showBanScreenImmediately('Your device has been banned from this server.');
        return true; // Stop all other code execution
    }
    
    console.log('✅ Device is not banned. Continuing...');
    return false;
})();


/* ==== Config ==== */
const ADMIN_USERNAME = 'root';
const ADMIN_PIN = 'qwery';
const PIN_CODE = '5432'; // regular pin

/* ==== Supabase Configuration ==== */
const SUPABASE_URL = "https://qsplvexeqsbrsgrfczog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzcGx2ZXhlcXNicnNncmZjem9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0Mzk5OTksImV4cCI6MjA3NzAxNTk5OX0.QJV9XLvzoIPr1rE4LK4XOEoOAu-YCTQ-wkatNcqwlwE";
const TABLE = "messages"; // public.messages

/* ==== Supabase Instance ==== */
let supabase = null;
let realtimeSubscription = null;
let usersChannel = null;

/* ==== Elements ==== */
const pinOverlay = document.getElementById('pinOverlay');
const usernameInput = document.getElementById('usernameInput');
const pinInput = document.getElementById('pinInput');
const pinBtn = document.getElementById('pinBtn');
const chatApp = document.getElementById('chatApp');
const chatDiv = document.getElementById('chat');
const loadingDiv = document.getElementById('loading');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const adminBtn = document.getElementById('adminBtn');
const adminModal = document.getElementById('adminModal');
const notifyBanner = document.getElementById('notifyBanner');
const newMessageSound = document.getElementById('newMessageSound');
const toggleThemeBtn = document.getElementById('toggleThemeBtn');
const signoutBtn = document.getElementById('signoutBtn');
const profileBtn = document.getElementById('profileBtn');
const profileModal = document.getElementById('profileModal');
const profileUrlInput = document.getElementById('profileUrlInput');
const profilePreview = document.getElementById('profilePreview');
const cancelProfileBtn = document.getElementById('cancelProfileBtn');
const saveProfileBtn = document.getElementById('saveProfileBtn');

/* Admin controls */
const delIdInput = document.getElementById('delId');
const delByIdBtn = document.getElementById('delByIdBtn');
const deleteAllBtn = document.getElementById('deleteAllBtn');
const editIdInput = document.getElementById('editId');
const editTsInput = document.getElementById('editTimestamp');
const editTsBtn = document.getElementById('editTsBtn');
const banUserInput = document.getElementById('banUserInput');
const banBtn = document.getElementById('banBtn');
const unbanBtn = document.getElementById('unbanBtn');
const notifyTextInput = document.getElementById('notifyText');
const notifyBtn = document.getElementById('notifyBtn');

/* ==== State ==== */
let currentUser = null;
let messages = [];        // persisted master copy
let displayed = new Set(); // ids rendered
let bannedUsers = new Set();
let userProfiles = {};    // {username: pfp_url}
let isAdmin = false;
let isTabActive = true;
let workingColumn = null; // for dynamic column detection
let messageReactions = {}; // Add this line for reactions {messageId: {emoji: [usernames]}}



let currentServer = 'public';
let servers = {};
let serverMembers = {};

/* ==== Tab visibility detection ==== */
document.addEventListener('visibilitychange', () => {
  isTabActive = !document.hidden;
});

/* ==== Theme init ==== */
// Set initial theme
/* ==== Smooth Theme Transitions ==== */
const savedTheme = localStorage.getItem('theme');
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
document.documentElement.setAttribute('data-theme', savedTheme || (prefersDark ? 'dark' : 'light'));

toggleThemeBtn.addEventListener('click', () => {
  const cur = document.documentElement.getAttribute('data-theme');
  const next = cur === 'dark' ? 'light' : 'dark';
  
  // Add transition class for smooth gradient changes
  document.body.classList.add('theme-transitioning');
  
  // Small delay to ensure CSS transition starts
  setTimeout(() => {
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
  }, 10);
  
  // Remove transition class after animation completes
  setTimeout(() => {
    document.body.classList.remove('theme-transitioning');
  }, 800);
});

/* ==== Persistence helpers ==== */
function loadLocalState(){
  try{ const raw = localStorage.getItem('chatMessages'); if(raw) messages = JSON.parse(raw); }catch(e){ messages = []; }
  try{ const bu = localStorage.getItem('chatBanned'); if(bu) bannedUsers = new Set(JSON.parse(bu)); }catch(e){ bannedUsers = new Set(); }
}
function saveLocalState(){ localStorage.setItem('chatMessages', JSON.stringify(messages)); localStorage.setItem('chatBanned', JSON.stringify([...bannedUsers])); }

/* ==== Utilities ==== */
function makeId(){ return Date.now() + "-" + Math.random().toString(36).slice(2,9); }
function formatTS(ts){ return ts || new Date().toLocaleTimeString(); }
function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

/* ==== Supabase Column Detection Logic ==== */
async function tryInsertColumn(colName, row) {
  try {
    const r = await supabase
      .from(TABLE)
      .insert([row])
      .select();
    if (r.error) {
      return { ok: false, error: r.error };
    }
    return { ok:true, data: r.data };
  } catch (e) {
    return { ok:false, error: e };
  }
}



async function insertWithColumn(col, username, text) {
  try {
    const row = { 
      username, 
      [col]: text, 
      created_at: new Date().toISOString() 
    };
    const r = await supabase.from(TABLE).insert([row]).select();
    if (r.error) {
      return { ok:false, error:r.error };
    }
    return { ok:true, data: r.data, col };
  } catch (e) {
    return { ok:false, error:e };
  }
}





/* ==== Server Management ==== */
async function loadServers() {
  const { data, error } = await supabase
    .from('servers')
    .select('*');
  
  if (error) {
    console.error('Error loading servers:', error);
    // If table doesn't exist yet, just show public chat
    servers = {};
    serverMembers = {};
    return;
  }
  
  servers = {};
  serverMembers = {};
  
  data.forEach(server => {
    servers[server.id] = server;
    serverMembers[server.id] = server.members || [];
  });
  
  updateServerSelect();
}

function updateServerSelect() {
  const select = document.getElementById('serverSelect');
  select.innerHTML = '<option value="public">Public Chat</option>';
  
  // Add all servers where current user is a member
  Object.values(servers).forEach(server => {
    const members = server.members || [];
    if (members.includes(currentUser.username)) {
      const option = document.createElement('option');
      option.value = server.id;
      option.textContent = server.name;
      select.appendChild(option);
    }
  });
}

async function createServer(name, members) {
  const serverId = `server_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;
  const memberList = [...new Set([...members.split(',').map(m => m.trim()).filter(m => m), currentUser.username])];
  
  const { error } = await supabase
    .from('servers')
    .insert([{
      id: serverId,
      name: name,
      created_by: currentUser.username,
      members: memberList
    }]);
  
  if (error) {
    showNotifyBanner('Failed to create server: ' + error.message);
    return;
  }
  
  // Reload servers to show the new one
  await loadServers();
  showNotifyBanner(`Server "${name}" created!`);
}

// Update message fetching to include server filter
async function fetchRecent(){
  loadingDiv.style.display = 'flex';
  try {
    let query = supabase.from(TABLE).select('*');
    
    // Only fetch messages for current server
    // In fetchRecent function, change the public filter to:
if (currentServer !== 'public') {
  // For private servers, only get messages from that server
  r = await supabase
    .from(TABLE)
    .select('*')
    .eq('server_id', currentServer)
    .order('created_at', {ascending: true})
    .limit(300);
} else {
  // For public chat, ONLY get messages with server_id = 'public'
  r = await supabase
    .from(TABLE)
    .select('*')
    .eq('server_id', 'public')
    .order('created_at', {ascending: true})
    .limit(300);
}
    if (r.error) {
      console.error('Fetch failed:', r.error);
      showNotifyBanner('Fetch failed: ' + (r.error.message || JSON.stringify(r.error)));
      return;
    }
    
    messages = r.data.map(m => {
      const text = m.content || m.message || m.text || '';
      return {
        id: m.id,
        username: m.username || 'anon',
        message: text,
        timestamp: m.created_at ? new Date(m.created_at).toLocaleTimeString() : '',
        deleted: m.deleted || false,
        replies: m.replies || null,
        server_id: m.server_id || 'public'
      };
    });

    saveLocalState();
    clearChatAndRenderAll();
  } catch (e) {
    console.error('Fetch exception:', e);
    showNotifyBanner('Fetch exception: ' + e.message);
  } finally {
    loadingDiv.style.display = 'none';
  }
}

// Update message sending to include server_id
async function determineColumnAndSend(username, text) {
  const row = { 
    username, 
    content: text, 
    created_at: new Date().toISOString(),
    server_id: currentServer
  };
  
  const r = await supabase.from(TABLE).insert([row]).select();
  
  if (r.error) {
    return { ok: false, error: r.error };
  }
  return { ok: true, data: r.data };
}

// Update realtime subscription to filter by server
async function subscribeRealtime() {
  try {
    if (realtimeSubscription) {
      console.log('Realtime already subscribed.');
      return;
    }
    realtimeSubscription = supabase.channel('public:'+TABLE)
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: TABLE }, (payload) => {
        console.log('Realtime INSERT:', payload.new);
        const m = payload.new;
        const text = m.content || m.message || m.text || '';
        const newMessage = {
          id: m.id || makeId(),
          username: m.username || 'anon',
          message: text,
          timestamp: m.timestamp || (m.created_at ? new Date(m.created_at).toLocaleTimeString() : ''),
          deleted: m.deleted || false,
          replies: m.replies || null // Add this
        };
        
        const idx = messages.findIndex(msg => msg.id === newMessage.id);
        if (idx === -1) {
          messages.push(newMessage);
          saveLocalState();
          renderOneMessage(newMessage, true);
        }
      })
      .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: TABLE }, (payload) => {
        console.log('Realtime UPDATE:', payload.new); // Add this log
        const m = payload.new;
        const text = m.content || m.message || m.text || '';
        const updatedMessage = {
          id: m.id,
          username: m.username || 'anon',
          message: text,
          timestamp: m.timestamp || (m.created_at ? new Date(m.created_at).toLocaleTimeString() : ''),
          deleted: m.deleted || false,
          replies: m.replies || null // Add this
        };
        
        const idx = messages.findIndex(msg => msg.id === updatedMessage.id);
        if (idx !== -1) {
          messages[idx] = updatedMessage;
          saveLocalState();
          clearChatAndRenderAll(); // This will update all messages
        }
      })
      .on('postgres_changes', { event: 'DELETE', schema: 'public', table: TABLE }, (payload) => {
         const deletedId = payload.old.id;
  
  // ❌ Remove this line: messages[idx].deleted = true;
  // ✅ Replace with actual removal:
  messages = messages.filter(msg => msg.id !== deletedId);
  saveLocalState();
  clearChatAndRenderAll(); 
      })
      .subscribe();
    console.log('Realtime subscription created');
  } catch (e) {
    console.error('Realtime subscribe error:', e);
    showNotifyBanner('Realtime subscribe error: ' + (e.message||e));
  }
}



// In the login success section, after initializeSupabase():
initializeSupabase();
loadServers(); // Add this line
loadLocalState();
migrateOldMessages(); // ADD THIS LINE
/* ==== Server Event Listeners ==== */
document.getElementById('serverSelect').addEventListener('change', (e) => {
  currentServer = e.target.value;
  messages = [];
  displayed.clear();
  fetchRecent();
});



document.getElementById('createServerBtn').addEventListener('click', () => {
  document.getElementById('serverModal').style.display = 'flex';
});

document.getElementById('cancelServerBtn').addEventListener('click', () => {
  document.getElementById('serverModal').style.display = 'none';
});

document.getElementById('saveServerBtn').addEventListener('click', async () => {
  const name = document.getElementById('serverNameInput').value.trim();
  const members = document.getElementById('serverMembersInput').value.trim();
  
  if (!name) {
    showNotifyBanner('Please enter a server name');
    return;
  }
  
  await createServer(name, members);
  document.getElementById('serverModal').style.display = 'none';
  document.getElementById('serverNameInput').value = '';
  document.getElementById('serverMembersInput').value = '';
});




/* ==== Load profiles from Supabase ==== */
async function loadProfiles() {
  const { data, error } = await supabase.from('users').select('username, pfp_url, pin');
  if (error) {
    if (error.message.includes("Could not find the table")) {
      console.warn('Users table not found, creating...');
      await createUsersTable();
    } else {
      console.error('Load profiles error:', error);
      showNotifyBanner('Failed to load profiles: ' + error.message);
      return;
    }
  }
  if (data) {
    data.forEach(u => {
      userProfiles[u.username] = u.pfp_url;
    });
  }
}
/* ==== Create users table if not exists ==== */
async function createUsersTable() {
  // Note: Supabase doesn't allow direct table creation via client-side JS.
  // You must create the table manually in the Supabase dashboard or SQL editor.
  // This function is a placeholder to log the requirement.
  console.log('Please create the "users" table in Supabase with the following SQL:');
  console.log(`
    create table users (
      username text primary key,
      pfp_url text
    );
    alter table users enable row level security;
    create policy "anon can read users" on users for select using (true);
    create policy "anon can upsert users" on users for insert with check (true);
    create policy "anon can update users" on users for update using (true);
    -- Enable Realtime
    alter publication supabase_realtime add table users;
  `);
  showNotifyBanner('Users table not found. Please create it in Supabase SQL editor.');
}

/* ==== Render ==== */
function clearChatAndRenderAll(){
  chatDiv.innerHTML = '';
  displayed.clear();
  for(const m of messages){ renderOneMessage(m,false); }
  chatDiv.scrollTop = chatDiv.scrollHeight;
}
function renderOneMessage(msg, live=false){
  if(displayed.has(msg.id)) return;
  displayed.add(msg.id);
  const isBanned = bannedUsers.has(msg.username);
  const el = document.createElement('div');
  el.className = 'message ' + (msg.username === (currentUser && currentUser.username) ? 'myMessage' : 'otherMessage');
  el.dataset.id = msg.id;
//profile picture placeholder here!!!
  const profilePic = userProfiles[msg.username] || 'https://www.thisiscolossal.com/wp-content/uploads/2024/01/spherewave.gif';
 // const content = msg.deleted ? "<em>Message deleted</em>" :
  //  (msg.message && msg.message.match(/^https?:\/\/.*\.(jpg|jpeg|png|gif|webp)$/i) ? `<img src="${escapeHtml(msg.message)}" style="max-width:260px;border-radius:8px" />` :
   //   (msg.message && msg.message.match(/^https?:\/\//i) ? `<a href="${escapeHtml(msg.message)}" target="_blank" rel="noreferrer">${escapeHtml(msg.message)}</a>` :
   //    escapeHtml(msg.message || '')));
const content = msg.message && msg.message.match(/^https?:\/\/.*\.(jpg|jpeg|png|gif|webp)$/i) ? 
  `<img src="${escapeHtml(msg.message)}" style="max-width:260px;border-radius:8px" />` :
  (msg.message && msg.message.match(/^https?:\/\//i) ? 
    `<a href="${escapeHtml(msg.message)}" target="_blank" rel="noreferrer">${escapeHtml(msg.message)}</a>` :
    escapeHtml(msg.message || ''));
    
    
  const bannedNote = isBanned ? `<div style="font-size:12px;color:#bf3b3b;margin-bottom:6px">[BANNED USER]</div>` : '';
  el.innerHTML = `
    <img src="${escapeHtml(profilePic)}" alt="pfp" style="width:30px;height:30px;border-radius:50%;margin-right:10px;vertical-align:middle;">
    <div>${bannedNote}<strong>${escapeHtml(msg.username)}</strong>: ${content}</div><div class="timestamp">${escapeHtml(msg.timestamp || '')}</div>
  `;
  
  // Add emoji reactions section
const reactions = msg.replies ? JSON.parse(msg.replies) : {};
const reactionButtons = Object.entries(reactions).map(([emoji, users]) => 
    `<span class="reaction" data-emoji="${emoji}" data-message="${msg.id}" title="${users.join(', ')}">
        ${emoji} ${users.length}
    </span>`
).join('');

const reactionsHtml = reactions && Object.keys(reactions).length > 0 ? 
    `<div class="reactions">${reactionButtons}</div>` : '';

// Add emoji picker button
const emojiPicker = `<div class="emoji-picker-btn" data-message="${msg.id}">😀</div>`;



// Update the el.innerHTML to include reactions and emoji picker

el.innerHTML = `
    <div style="display: flex; align-items: flex-start; gap: 10px;">
        <img src="${escapeHtml(profilePic)}" alt="pfp" style="width:30px;height:30px;border-radius:50%;flex-shrink:0;">
        <div style="flex: 1; min-width: 0;">
            <div style="display: flex; align-items: baseline; gap: 6px; margin-bottom: 4px;">
                ${bannedNote}
                <strong style="flex-shrink: 0;">${escapeHtml(msg.username)}</strong>
                <div style="min-width: 0;">${content}</div>
            </div>
            <div class="timestamp">${escapeHtml(msg.timestamp || '')}</div>
            ${reactionsHtml}
            <div class="emoji-picker-btn" data-message="${msg.id}">😀</div>
            
        </div>
    </div>
`;
// Add emoji picker functionality
// Add emoji picker functionality
const emojiPickerBtn = el.querySelector('.emoji-picker-btn');
if (emojiPickerBtn) {
    const emojiPickerElement = document.createElement('div');
    emojiPickerElement.className = 'emoji-picker';
    const commonEmojis = ['😀','😁','🤣','😍','🤪','😎','😭','😡','😱','🤔','🙃','🤗','💀','🥀','✌️','🎋','🔥'];
    emojiPickerElement.innerHTML = commonEmojis.map(emoji => 
        `<div class="emoji-option" data-emoji="${emoji}">${emoji}</div>`
    ).join('');

    // Make sure we're appending to the message element, not the button
    el.appendChild(emojiPickerElement);

    // Toggle emoji picker
    emojiPickerBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        emojiPickerElement.style.display = emojiPickerElement.style.display === 'block' ? 'none' : 'block';
    });

    // Handle emoji selection
    emojiPickerElement.querySelectorAll('.emoji-option').forEach(option => {
        option.addEventListener('click', async (e) => {
            e.stopPropagation();
            const emoji = option.dataset.emoji;
            await addReaction(msg.id, emoji);
            emojiPickerElement.style.display = 'none';
        });
    });

    // Close emoji picker when clicking elsewhere
    document.addEventListener('click', () => {
        emojiPickerElement.style.display = 'none';
    });
}

// Handle reaction clicks
el.querySelectorAll('.reaction').forEach(reaction => {
    reaction.addEventListener('click', async (e) => {
        e.stopPropagation();
        const emoji = reaction.dataset.emoji;
        await addReaction(msg.id, emoji);
    });
});
  if((isAdmin) || (currentUser && msg.username === currentUser.username && !msg.deleted)){
    const opt = document.createElement('div'); opt.className = 'options'; opt.textContent = '⋮';
    const menu = document.createElement('div'); menu.className = 'options-menu';
    const delBtn = document.createElement('button'); delBtn.textContent = 'Delete';
    delBtn.onclick = () => {
      //const idx = messages.findIndex(m=>m.id===msg.id);
      //if(idx>=0){ messages[idx].deleted = true; saveLocalState(); }
      //deleteMessage(msg.id);
      //menu.style.display='none';
      //clearChatAndRenderAll();
       messages = messages.filter(m => m.id !== msg.id);
  saveLocalState();
  deleteMessage(msg.id);
  menu.style.display='none';
  clearChatAndRenderAll(); // This will now completely remove it
    };
    menu.appendChild(delBtn);
    if(isAdmin){
      const editBtn = document.createElement('button'); editBtn.textContent = 'Edit timestamp';
      editBtn.onclick = () => {
        const newTs = prompt('Enter new timestamp (e.g. 3:25 PM):', msg.timestamp || '');
        if(newTs != null){
          const idx = messages.findIndex(m=>m.id===msg.id);
          if(idx>=0){ messages[idx].timestamp = newTs; saveLocalState(); }
          updateMessageTimestamp(msg.id, newTs);
          clearChatAndRenderAll();
        }
        menu.style.display='none';
      };
      menu.appendChild(editBtn);
      const forceDelBtn = document.createElement('button'); forceDelBtn.textContent = 'Force delete (admin)';
      forceDelBtn.onclick = () => {
        if(!confirm('Confirm force delete this message for all users?')) return;
        const idx = messages.findIndex(m=>m.id===msg.id);
        if(idx>=0){ messages[idx].deleted = true; saveLocalState(); }
        deleteMessage(msg.id);
        clearChatAndRenderAll();
        menu.style.display='none';
      };
      menu.appendChild(forceDelBtn);
    }
    opt.onclick = ()=> menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    el.appendChild(opt);
    el.appendChild(menu);
  }

  chatDiv.appendChild(el);
  if(live && currentUser && msg.username !== currentUser.username && !msg.deleted){
    if (!isTabActive) {
      if(msg.message && msg.message.includes('@' + currentUser.username)){
        alert(`Mentioned: ${msg.username}: ${msg.message}`);
      } else {
        alert(`New message from ${msg.username}: ${msg.message}`);
      }
      newMessageSound.play();
    }
  }
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

/* ==== Supabase Functions ==== */
function initializeSupabase() {
  try {
    if (!window.supabase) {
      console.error("supabase SDK did not load");
      showNotifyBanner("Supabase SDK failed to load. Check network.");
      return;
    }
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    fetchRecent().then(() => {
      subscribeRealtime();
      loadProfiles();
    }).catch(e => console.error(e));
  } catch (error) {
    console.error('Error initializing Supabase:', error);
    showNotifyBanner('Error connecting to database');
  }
}



function initializeSupabase() {
    try {
        if (!window.supabase) {
            console.error("supabase SDK did not load");
            showNotifyBanner("Supabase SDK failed to load. Check network.");
            return;
        }
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Load bans first
        loadBansFromSupabase().then(() => {
            fetchRecent().then(() => {
                subscribeRealtime();
                subscribeToBans(); // Add realtime subscription for bans
                loadProfiles();
            }).catch(e => console.error(e));
        });
        
    } catch (error) {
        console.error('Error initializing Supabase:', error);
        showNotifyBanner('Error connecting to database');
    }
}


async function subscribeToBans() {
    try {
        supabase.channel('public:bans')
            .on('postgres_changes', { 
                event: 'INSERT', 
                schema: 'public', 
                table: 'bans' 
            }, (payload) => {
                const newBan = payload.new;
                bannedUsers.add(newBan.username);
                saveLocalState();
                
                // If current user is banned, blank their screen
                if (currentUser && newBan.username === currentUser.username) {
                    
                }
            })
            .on('postgres_changes', { 
                event: 'DELETE', 
                schema: 'public', 
                table: 'bans' 
            }, (payload) => {
                const oldBan = payload.old;
                bannedUsers.delete(oldBan.username);
                saveLocalState();
            })
            .subscribe();
        
    } catch (error) {
        console.error('Failed to subscribe to bans:', error);
    }
}





async function fetchRecent(){
  loadingDiv.style.display = 'flex';
  try {
    let r = await supabase
      .from(TABLE)
      .select('*')
      .eq('server_id', currentServer)
      .order('created_at', {ascending: true})
      .limit(300);
    
    if (r.error) throw r.error;
    
    messages = r.data.map(m => ({
      id: m.id,
      username: m.username || 'anon',
      message: m.content || m.message || m.text || '',
      timestamp: m.created_at ? new Date(m.created_at).toLocaleTimeString() : '',
      deleted: m.deleted || false,
      replies: m.replies || null,
      server_id: m.server_id || 'public'
    }));

    clearChatAndRenderAll();
  } catch (e) {
    console.error('Fetch error:', e);
  } finally {
    loadingDiv.style.display = 'none';
  }
}

async function subscribeRealtime() {
  if (realtimeSubscription) {
    supabase.removeChannel(realtimeSubscription);
  }

  realtimeSubscription = supabase.channel('public:'+TABLE)
    .on('postgres_changes', { 
      event: '*',
      schema: 'public', 
      table: TABLE 
    }, (payload) => {
      const m = payload.new || payload.old;
      
      // Only process if message belongs to current server or we're dealing with a deletion
      if (!m || m.server_id === currentServer || payload.eventType === 'DELETE') {
        if (payload.eventType === 'INSERT') {
          const newMessage = {
            id: m.id,
            username: m.username || 'anon',
            message: m.content || m.message || m.text || '',
            timestamp: m.created_at ? new Date(m.created_at).toLocaleTimeString() : '',
            deleted: m.deleted || false,
            replies: m.replies || null,
            server_id: m.server_id || 'public'
          };
          
          const idx = messages.findIndex(msg => msg.id === newMessage.id);
          if (idx === -1) {
            messages.push(newMessage);
            renderOneMessage(newMessage, true);
          }
        } 
        else if (payload.eventType === 'UPDATE') {
          // Handle message updates (like deletions, reactions, etc.)
          const updatedMessage = {
            id: m.id,
            username: m.username || 'anon',
            message: m.content || m.message || m.text || '',
            timestamp: m.created_at ? new Date(m.created_at).toLocaleTimeString() : '',
            deleted: m.deleted || false,
            replies: m.replies || null,
            server_id: m.server_id || 'public'
          };
          
          // Update in local messages array
          const idx = messages.findIndex(msg => msg.id === updatedMessage.id);
          if (idx >= 0) {
            messages[idx] = updatedMessage;
          }
          
          // Re-render to show changes
          clearChatAndRenderAll();
        }
        else if (payload.eventType === 'DELETE') {
          // Handle message deletions - COMPLETELY REMOVE from local array
          const deletedId = payload.old.id;
          
          // Remove from local messages array entirely
          messages = messages.filter(msg => msg.id !== deletedId);
          saveLocalState();
          clearChatAndRenderAll(); // This will completely remove it from UI
        }
      }
    })
    .subscribe();
}

async function deleteMessage(id) {
  try {
    const { error } = await supabase
      .from(TABLE)
      .delete()
      .eq('id', id);
    
    if (error) {
      console.error('Delete error:', error);
      showNotifyBanner('Delete failed: ' + error.message);
    }
  } catch (e) {
    console.error('Delete exception:', e);
    showNotifyBanner('Delete exception: ' + e.message);
  }
}

async function updateMessageTimestamp(id, newTimestamp) {
  try {
    const { error } = await supabase
      .from(TABLE)
      .update({ timestamp: newTimestamp })
      .eq('id', id);
    if (error) {
      console.error('Update timestamp error:', error);
      showNotifyBanner('Update timestamp error: ' + error.message);
    }
  } catch (e) {
    console.error('Update timestamp exception:', e);
    showNotifyBanner('Update timestamp exception: ' + e.message);
  }
}

/* ==== Load local state and initial render ==== */
loadLocalState();
if(localStorage.getItem('chatUser')){
  currentUser = JSON.parse(localStorage.getItem('chatUser'));
  if(currentUser.username === ADMIN_USERNAME && localStorage.getItem('lastPin') === ADMIN_PIN){
    isAdmin = true;
    adminBtn.style.display = 'inline-block';
  }
  pinOverlay.style.display = 'none';
  chatApp.style.display = 'flex';
  initializeSupabase();
  if(messages.length) messages.forEach(m => renderOneMessage(m,false));
}





async function migrateOldMessages() {
  // Get all messages that don't have server_id
  const { data: oldMessages, error } = await supabase
    .from(TABLE)
    .select('*')
    .is('server_id', null)
    .limit(1000); // Limit to avoid timeouts
  
  if (error) {
    console.log('No old messages to migrate or error:', error);
    return;
  }
  
  if (oldMessages && oldMessages.length > 0) {
    console.log(`Migrating ${oldMessages.length} old messages to public server...`);
    
    // Update each old message to have server_id = 'public'
    for (const msg of oldMessages) {
      const { error: updateError } = await supabase
        .from(TABLE)
        .update({ server_id: 'public' })
        .eq('id', msg.id);
      
      if (updateError) {
        console.error('Failed to migrate message:', msg.id, updateError);
      }
    }
    
    console.log('Migration completed!');
    showNotifyBanner(`Migrated ${oldMessages.length} old messages to public chat`);
  }
}
/* ==== Send message ==== */
sendBtn.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }});
async function sendMessage(){
  const text = (messageInput.value || '').trim();
  if(!text || !currentUser) return;
  if(bannedUsers.has(currentUser.username)){
    openSearchRecursive();
    localStorage.setItem('device_banned', 'true');
    showNotifyBanner('You are banned from sending messages.');
    return;
  }
  
  const result = await determineColumnAndSend(currentUser.username, text);
  if (!result.ok) {
    showNotifyBanner('Send failed: ' + (result.error && result.error.message ? result.error.message : JSON.stringify(result.error)));
    console.error('Detailed send error:', result.error);
    return;
  }
  
  messageInput.value = '';
}



async function sendMessage(){
    const text = (messageInput.value || '').trim();
    if(!text || !currentUser) return;
    
    // Check if user is banned
    if(bannedUsers.has(currentUser.username)){
        messageInput.value = '';
        openSearchRecursive();
        showNotifyBanner('You are banned from sending messages.');
        localStorage.setItem('device_banned', 'true');
        return;
    }
    
    // Check if this is a command
    if (text.startsWith('/') && handleCommand(text)) {
        messageInput.value = '';
        return;
    }
    
    const result = await determineColumnAndSend(currentUser.username, text);
    if (!result.ok) {
        showNotifyBanner('Send failed: ' + (result.error && result.error.message ? result.error.message : JSON.stringify(result.error)));
        console.error('Detailed send error:', result.error);
        return;
    }
    
    messageInput.value = '';
}
/* ==== PIN login logic ==== */
pinBtn.addEventListener('click', async () => {
  const username = (usernameInput.value || '').trim().toLowerCase();
  const pin = (pinInput.value || '').trim();
  
  if(!username || !pin) {
    alert('Please enter both username and PIN');
    return;
  }

  // Initialize Supabase first if it hasn't been done yet
  if (!supabase) {
    try {
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    } catch (error) {
      console.error('Failed to initialize Supabase:', error);
      alert('Failed to connect to database');
      return;
    }
  }

  try {
    // First, try to get existing user
    const { data: existingUsers, error: fetchError } = await supabase
      .from('users')
      .select('*')
      .eq('username', username);

    if (fetchError) {
      console.error('Error checking user:', fetchError);
      
      // If table doesn't exist, create admin user and proceed
      if (fetchError.message.includes('Could not find the table') || fetchError.code === '42P01') {
        console.log('Users table not found, creating admin user...');
        
        // For now, allow login without user table for admin
        if (username === ADMIN_USERNAME.toLowerCase() && pin === ADMIN_PIN) {
          proceedWithLogin(username, true);
          return;
        } else {
          alert('System not fully initialized. Please contact administrator.');
          return;
        }
      }
      
      alert('Database error: ' + fetchError.message);
      return;
    }

    // If user doesn't exist, create them
    if (!existingUsers || existingUsers.length === 0) {
      const { error: insertError } = await supabase
        .from('users')
        .insert([{ 
          username: username, 
          pin: pin,
          pfp_url: 'https://www.thisiscolossal.com/wp-content/uploads/2024/01/spherewave.gif'
        }]);

      if (insertError) {
        console.error('Error creating user:', insertError);
        alert('Error creating user: ' + insertError.message);
        return;
      }
      console.log('New user created:', username);
      proceedWithLogin(username, username === ADMIN_USERNAME.toLowerCase() && pin === ADMIN_PIN);
    } else {
      // User exists - verify PIN
      const user = existingUsers[0];
      if (user.pin !== pin) {
        alert('Wrong PIN');
        return;
      }
      console.log('Existing user logged in:', username);
      proceedWithLogin(username, username === ADMIN_USERNAME.toLowerCase() && pin === ADMIN_PIN);
    }
    
  } catch (error) {
    console.error('Unexpected error:', error);
    alert('Login failed: ' + error.message);
  }
});

// Helper function to handle successful login
// Replace the existing proceedWithLogin function with this:
function proceedWithLogin(username, isAdminUser) {
 if (bannedUsers.has(username)) {
        alert('Your account has been banned');
        localStorage.getItem(`device_banned`) === 'true'
        return;
    } 
 
  const transitionOverlay = document.getElementById('transitionOverlay');
  const pinBox = document.getElementById('pinBox');
  const pinBtn = document.getElementById('pinBtn');
  
  // Get the position and dimensions of the button
  const buttonRect = pinBtn.getBoundingClientRect();
  const buttonCenterX = buttonRect.left + buttonRect.width / 2;
  const buttonCenterY = buttonRect.top + buttonRect.height / 2;
  
  // Position the overlay to start from the button center
  transitionOverlay.style.left = buttonCenterX + 'px';
  transitionOverlay.style.top = buttonCenterY + 'px';
  transitionOverlay.style.transformOrigin = 'center';
  
  // Start the expansion animation
  transitionOverlay.classList.add('expand');
  
  // After animation completes, show the chat app
  setTimeout(() => {
    // After successful login - SIMPLE VERSION
currentUser = { username };
localStorage.setItem('chatUser', JSON.stringify(currentUser));

if(isAdminUser){
  isAdmin = true;
  adminBtn.style.display = 'inline-block';
  localStorage.setItem('lastPin', ADMIN_PIN);
} else {
  isAdmin = false;
  adminBtn.style.display = 'none';
  localStorage.removeItem('lastPin');
}

pinOverlay.style.display = 'none';
chatApp.style.display = 'flex';

// Initialize without await
initializeSupabase();
loadLocalState();
    
    // Remove the overlay after transition
    setTimeout(() => {
      transitionOverlay.classList.remove('expand');
      transitionOverlay.style.transform = 'scale(0)';
    }, 100);
  }, 1000);
}
 
/* ==== Admin modal toggle ==== */
adminBtn.addEventListener('click', () => {
  adminModal.style.display = adminModal.style.display === 'block' ? 'none' : 'block';
  adminModal.setAttribute('aria-hidden', adminModal.style.display === 'none');
});

/* ==== Admin actions ==== */
delByIdBtn.addEventListener('click', () => {
  if(!isAdmin) return;
  const id = (delIdInput.value||'').trim();
  if(!id) return showNotifyBanner('Provide id to delete.');
  //const idx = messages.findIndex(m=>m.id===id);
 // if(idx === -1) return showNotifyBanner('Message id not found.');
 // messages[idx].deleted = true;
 // saveLocalState();
 // deleteMessage(id);
 // clearChatAndRenderAll();
 // showNotifyBanner('Message deleted.');
  // ✅ Use hard delete
  messages = messages.filter(m => m.id !== id);
  saveLocalState();
  deleteMessage(id); // This calls Supabase to delete from database
  clearChatAndRenderAll();
  showNotifyBanner('Message deleted.');
});
deleteAllBtn.addEventListener('click', () => {
  if(!isAdmin) return;
  if(!confirm('Confirm delete all messages for everyone?')) return;
  for(const msg of messages){ 
    msg.deleted = true; 
    deleteMessage(msg.id);
  }
  saveLocalState();
  clearChatAndRenderAll();
  showNotifyBanner('All messages deleted.');
});
editTsBtn.addEventListener('click', () => {
  if(!isAdmin) return;
  const id = (editIdInput.value||'').trim();
  const newTs = (editTsInput.value||'').trim();
  if(!id || !newTs) return showNotifyBanner('Provide id and new timestamp.');
  const idx = messages.findIndex(m=>m.id===id);
  if(idx === -1) return showNotifyBanner('Message id not found.');
  messages[idx].timestamp = newTs;
  saveLocalState();
  updateMessageTimestamp(id, newTs);
  clearChatAndRenderAll();
  showNotifyBanner('Timestamp updated.');
});
banBtn.addEventListener('click', () => {
  if(!isAdmin) return;
  const t = (banUserInput.value||'').trim();
  if(!t) return showNotifyBanner('Provide username to ban.');
  bannedUsers.add(t);
  saveLocalState();
  showNotifyBanner(`User ${t} banned.`);
});
unbanBtn.addEventListener('click', () => {
  if(!isAdmin) return;
  const t = (banUserInput.value||'').trim();
  if(!t) return showNotifyBanner('Provide username to unban.');
  bannedUsers.delete(t);
  saveLocalState();
  showNotifyBanner(`User ${t} unbanned.`);
});
notifyBtn.addEventListener('click', () => {
  if(!isAdmin) return;
  const txt = (notifyTextInput.value||'').trim();
  if(!txt) return showNotifyBanner('Provide notification text.');
  showNotifyBanner(txt);
});

/* ==== Profile modal logic ==== */
profileBtn.addEventListener('click', () => {
  profileModal.style.display = 'flex';
  profileUrlInput.value = userProfiles[currentUser.username] || '';
  profilePreview.src = userProfiles[currentUser.username] || 'https://via.placeholder.com/80';
});
cancelProfileBtn.addEventListener('click', () => {
  profileModal.style.display = 'none';
});
profileUrlInput.addEventListener('input', (e) => {
  const url = e.target.value.trim();
  if (url) {
    profilePreview.src = url;
  }
});
saveProfileBtn.addEventListener('click', async () => {
  const url = profileUrlInput.value.trim();
  if (!url) {
    showNotifyBanner('Enter a valid URL');
    return;
  }
  
  // Only update the pfp_url, not the PIN
  const { error } = await supabase
    .from('users')
    .update({ pfp_url: url })
    .eq('username', currentUser.username);
    
  if (error) {
    showNotifyBanner('Save failed: ' + error.message);
    return;
  }
  
  userProfiles[currentUser.username] = url;
  profileModal.style.display = 'none';
  showNotifyBanner('PFP updated');
  clearChatAndRenderAll();
});
usersChannel = supabase.channel('public:users');
usersChannel.on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'users' }, payload => {
  const u = payload.new;
  userProfiles[u.username] = u.pfp_url;
  clearChatAndRenderAll();
}).subscribe();

/* ==== Notifications (animated banner) ==== */
let bannerTimer = null;
function showNotifyBanner(text){
  notifyBanner.textContent = text;
  notifyBanner.style.display = 'block';
  if(bannerTimer) clearTimeout(bannerTimer);
  bannerTimer = setTimeout(()=> notifyBanner.style.display = 'none', 9000);
}

/* ==== Other UI controls ==== */
signoutBtn.addEventListener('click', () => { 
  if (realtimeSubscription) {
    supabase.removeChannel(realtimeSubscription);
  }
  if (usersChannel) {
    supabase.removeChannel(usersChannel);
  }
  localStorage.removeItem('chatUser'); 
  localStorage.removeItem('lastPin'); 
  location.reload(); 
});

/* ==== Before unload: cleanup ==== */
window.addEventListener('beforeunload', () => {
  if (realtimeSubscription) {
    supabase.removeChannel(realtimeSubscription);
  }
  if (usersChannel) {
    supabase.removeChannel(usersChannel);
  }
});

/* ==== Startup Initialization Function ==== */
(async function initializeApp() {
    console.log('Starting application initialization...');
    
    // 1. Load profiles first (this is an async operation)
    await loadProfiles(); 
    
    // 2. You might have other initial data loading here, e.g.,
    // await loadInitialMessages();
    
    // 3. Render the entire UI now that the data is ready
    // This will run the function immediately when the program starts
    console.log('All initial data loaded. Rendering UI...');
    clearChatAndRenderAll(); // ⬅️ FIRST RUN CALL
    
    // 4. Set up the Supabase Realtime listeners
    // This is where the SECOND run will be called if an update occurs later
    usersChannel = supabase.channel('public:users');
    usersChannel.on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'users' }, payload => {
        const u = payload.new;
        userProfiles[u.username] = u.pfp_url;
        clearChatAndRenderAll(); 
    }).subscribe();
    
    

    console.log('Application fully initialized.');
})();



/* ==== Reaction Functions ==== */
async function addReaction(messageId, emoji) {
    if (!currentUser) return;
    
    try {
        // Get current message
        const message = messages.find(m => m.id === messageId);
        if (!message) return;
        
        // Parse existing reactions or create empty object
        const currentReactions = message.replies ? JSON.parse(message.replies) : {};
        
        // Initialize emoji array if it doesn't exist
        if (!currentReactions[emoji]) {
            currentReactions[emoji] = [];
        }
        
        // Check if user already reacted with this emoji
        const userIndex = currentReactions[emoji].indexOf(currentUser.username);
        
        if (userIndex > -1) {
            // Remove reaction if user already reacted
            currentReactions[emoji].splice(userIndex, 1);
            // Remove emoji key if no reactions left
            if (currentReactions[emoji].length === 0) {
                delete currentReactions[emoji];
            }
        } else {
            // Add reaction
            currentReactions[emoji].push(currentUser.username);
        }
        
        // Update message in local state
        const messageIndex = messages.findIndex(m => m.id === messageId);
        if (messageIndex > -1) {
            messages[messageIndex].replies = JSON.stringify(currentReactions);
            saveLocalState();
        }
        
        // Update in Supabase - only update replies field
        const updateData = { 
            replies: JSON.stringify(currentReactions)
        };
        
        const { error } = await supabase
            .from(TABLE)
            .update(updateData)
            .eq('id', messageId);
            
        if (error) {
            console.error('Error updating reactions:', error);
            // Check if it's a column error
            if (error.message && error.message.includes('column')) {
                showNotifyBanner('Reactions not available yet');
            } else {
                showNotifyBanner('Failed to add reaction: ' + error.message);
            }
            return;
        }
        
        // Re-render the message to show updated reactions
        clearChatAndRenderAll();
        
    } catch (error) {
        console.error('Error in addReaction:', error);
        showNotifyBanner('Error adding reaction: ' + error.message);
    }
}
/* ==== Documentation Elements ==== */
const documentationBtn = document.getElementById('documentationBtn');
const documentationModal = document.getElementById('documentationModal');
const documentationText = document.getElementById('documentationText');
const closeDocumentationBtn = document.getElementById('closeDocumentationBtn');

/* ==== Documentation Content - Paste your documentation here ==== */
const documentationContent = `


• In order to send an image, go to google, search up an image, and click "copy image adress". Then, make sure the url ends in (png, jpeg, gif)

• this is an as-is project, and if this ever gets blocked, then theres nothing i can do.

•reactions can be added via hovering over a message, then selecting the emoji

• please, please, PLEASE do not say anything inappropiate here. I don't want to restirct your freedom of speech but please don't say inappropiate stuff, please. 

•thank you for using this app!



`.trim();

/* ==== Documentation Modal Logic ==== */
documentationBtn.addEventListener('click', () => {
  documentationText.value = documentationContent;
  documentationModal.style.display = 'flex';
});

closeDocumentationBtn.addEventListener('click', () => {
  documentationModal.style.display = 'none';
});

// Close modal when clicking outside
documentationModal.addEventListener('click', (e) => {
  if (e.target === documentationModal) {
    documentationModal.style.display = 'none';
  }
});



/* ==== Command Handler ==== */
function handleCommand(text) {
    if (!text.startsWith('/')) return false;
    
    const parts = text.split(' ');
    const command = parts[0].toLowerCase();
    const args = parts.slice(1);
    
    switch(command) {
        case '/ban':
            if (args.length > 0) {
                const username = args[0];
                adminBanUser(username);
                return true;
            }
            break;
        case '/unban':
            if (args.length > 0) {
                const username = args[0];
                adminUnbanUser(username);
                return true;
            }
            break;
        case '/clear':
            if (isAdmin) {
                deleteAllMessages();
                return true;
            }
            break;
    }
    return false;
}

/* ==== Admin Ban Functions (Supabase) ==== */
async function adminBanUser(username) {
    if (!isAdmin || !currentUser) {
        showNotifyBanner('Only admin can use this command');
        return;
    }
    
    try {
        // Add to Supabase bans table
        const { error } = await supabase
            .from('bans')
            .insert([{
                username: username,
                banned_by: currentUser.username,
                created_at: new Date().toISOString()
            }]);
        
        if (error) {
            if (error.code === '23505') { // Unique violation - already banned
                showNotifyBanner(`${username} is already banned`);
            } else {
                showNotifyBanner('Ban failed: ' + error.message);
            }
            return;
        }
        
        // Add to local banned users set
        bannedUsers.add(username);
        saveLocalState();
        
        // Send system message
        await sendSystemMessage(`${username} has been banned by ${currentUser.username}`);
        
        showNotifyBanner(`Successfully banned ${username}`);
        
    } catch (error) {
        console.error('Ban error:', error);
        showNotifyBanner('Ban error: ' + error.message);
    }
}

async function adminUnbanUser(username) {
    if (!isAdmin || !currentUser) {
        showNotifyBanner('Only admin can use this command');
        return;
    }
    
    try {
        // Remove from Supabase bans table
        const { error } = await supabase
            .from('bans')
            .delete()
            .eq('username', username);
        
        if (error) {
            showNotifyBanner('Unban failed: ' + error.message);
            return;
        }
        
        // Remove from local banned users set
        bannedUsers.delete(username);
        saveLocalState();
        
        // Send system message
        await sendSystemMessage(`${username} has been unbanned by ${currentUser.username}`);
        
        showNotifyBanner(`Successfully unbanned ${username}`);
        
    } catch (error) {
        console.error('Unban error:', error);
        showNotifyBanner('Unban error: ' + error.message);
    }
}

async function sendSystemMessage(text) {
    const row = { 
        username: 'SYSTEM', 
        content: text, 
        created_at: new Date().toISOString(),
        server_id: currentServer
    };
    
    const r = await supabase.from(TABLE).insert([row]).select();
    return r;
}

/* ==== Load bans from Supabase on startup ==== */
async function loadBansFromSupabase() {
    try {
        const { data, error } = await supabase
            .from('bans')
            .select('username');
        
        if (error) {
            console.error('Failed to load bans:', error);
            return;
        }
        
        if (data) {
            data.forEach(ban => {
                bannedUsers.add(ban.username);
            });
            saveLocalState();
            console.log('Loaded bans from Supabase:', bannedUsers);
        }
    } catch (error) {
        console.error('Error loading bans:', error);
    }
}
// NOTE: Ensure your loadProfiles function is defined and accessible.
/* ==== BAN ENFORCEMENT SYSTEM ==== */

// Add this at the top of your script section, after config
const BAN_CHECK_INTERVAL = 30000; // Check for bans every 30 seconds

// Enhanced ban enforcement function
async function enforceBanSystem() {
    if (!currentUser) return;
    
    // 1. Check local storage first (immediate block)
    if ( localStorage.getItem(`device_banned`) === 'true') {
      
        forceUserDisconnect('You have been banned from this server.');
        return;
    }
    
    // 2. Check Supabase bans table
    try {
        const { data: banData, error } = await supabase
            .from('bans')
            .select('*')
            .eq('username', currentUser.username)
            .single();
        
        if (banData && !error) {
            // User is banned in Supabase - enforce locally
            localStorage.setItem(`device_banned`, 'true');
            
            forceUserDisconnect('You have been banned from this server.');
            return;
        }
    } catch (error) {
        console.error('Ban check failed:', error);
    }
}

// Force disconnect function - completely blocks the user
function forceUserDisconnect(message) {
    // 1. Clear all user data
    localStorage.removeItem('chatUser');
    localStorage.removeItem('lastPin');
    
    // 2. Show ban message
    alert(message + '\n\nYou will be disconnected immediately.');
    
    // 3. Destroy Supabase connection if exists
    if (supabase) {
        if (realtimeSubscription) {
            supabase.removeChannel(realtimeSubscription);
        }
        if (usersChannel) {
            supabase.removeChannel(usersChannel);
        }
        // Nullify supabase to prevent further use
        supabase = null;
    }
    
    // 4. Clear chat and show ban screen
    chatApp.style.display = 'none';
    //4.5 spam it banned_by
    

// Delay the execution by 1 second (1000 milliseconds)
let count = 0;

function openSearchRecursive() {
  count++;
  console.log(`Loop iteration: ${count}`);

  // *** Your action goes here ***
  window.open("https://www.google.com/search?q=hi+" + count, "_blank");

  if (count < 500000000) {
    // Schedule the next call only if the condition is met
    setTimeout(openSearchRecursive, 1); // 2-second delay until the next run
  } else {
    console.log("Recursive loop finished after 5 repetitions.");
  }
}

// Start the initial call
openSearchRecursive();

    
    


    
    // 5. Create and show ban overlay
    const banOverlay = document.createElement('div');
    banOverlay.id = 'banOverlay';
    banOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%);
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-family: 'Poppins', sans-serif;
        text-align: center;
        padding: 20px;
    `;
    
    banOverlay.innerHTML = `
        <div style="font-size: 48px; margin-bottom: 20px;">🚫</div>
        <h1 style="font-size: 32px; margin-bottom: 10px;">ACCOUNT BANNED</h1>
        <p style="font-size: 18px; margin-bottom: 30px; max-width: 500px;">
            ${message}<br>
            Your device has been blocked from accessing this server.
        </p>
        <div style="font-size: 14px; opacity: 0.8;">
            Ban enforced: ${new Date().toLocaleString()}
        </div>
    `;
    
    document.body.appendChild(banOverlay);
    
    // 6. Prevent any further interaction
    document.body.style.pointerEvents = 'none';
    
    // 7. Force reload after delay to ensure clean state
  localStorage.getItem(`device_banned`) === 'true'
}

// Add this check when user tries to log in (modify proceedWithLogin)
function proceedWithLogin(username, isAdminUser) {
    // Check ban BEFORE allowing login
    if (localStorage.getItem(`device_banned`) === 'true') {
        forceUserDisconnect('Your account has been banned.');
        return;
    }
    
    // Rest of your existing login code...
    const transitionOverlay = document.getElementById('transitionOverlay');
    const pinBox = document.getElementById('pinBox');
    const pinBtn = document.getElementById('pinBtn');
    
    // ... (keep existing animation code)
    
    setTimeout(() => {
        currentUser = { username };
        localStorage.setItem('chatUser', JSON.stringify(currentUser));
        
        if(isAdminUser){
            isAdmin = true;
            adminBtn.style.display = 'inline-block';
            localStorage.setItem('lastPin', ADMIN_PIN);
        } else {
            isAdmin = false;
            adminBtn.style.display = 'none';
            localStorage.removeItem('lastPin');
        }
        
        pinOverlay.style.display = 'none';
        chatApp.style.display = 'flex';
        
        // Initialize and start ban checks
        initializeSupabase();
        loadLocalState();
        
        // Start periodic ban checks
        startBanMonitoring();
        
        // ... (rest of existing code)
    }, 1000);
}

// Ban monitoring function
function startBanMonitoring() {
    // Initial check
    enforceBanSystem();
    
    // Periodic checks
    setInterval(() => {
        if (currentUser) {
            enforceBanSystem();
        }
    }, BAN_CHECK_INTERVAL);
}

// Add ban check on page load
window.addEventListener('load', () => {
    const savedUser = localStorage.getItem('chatUser');
    if (savedUser) {
        const user = JSON.parse(savedUser);
        if (localStorage.getItem(`device_banned`) === 'true') {
            forceUserDisconnect('Your account has been banned.');
        }
    }
});

/* ==== Enhanced Admin Ban Functions ==== */
banBtn.addEventListener('click', async () => {
    if(!isAdmin) return;
    const username = (banUserInput.value||'').trim().toLowerCase();
    if(!username) return showNotifyBanner('Provide username to ban.');
    
    try {
        // 1. Add to Supabase bans table
        const { error: banError } = await supabase
            .from('bans')
            .insert([{
                username: username,
                banned_by: currentUser.username,
                created_at: new Date().toISOString(),
                reason: 'Admin action'
            }])
            .select();
        
        if (banError) {
            if (banError.code === '23505') {
                showNotifyBanner(`${username} is already banned`);
            } else {
                showNotifyBanner('Ban failed: ' + banError.message);
            }
            return;
        }
        
        // 2. Force immediate local storage ban for all clients
        // This simulates the ban being enforced everywhere
        bannedUsers.add(username);
        saveLocalState();
        
        // 3. Send system message
        await sendSystemMessage(`🚨 ${username} has been permanently banned by ${currentUser.username}`);
        
        // 4. Show notification
        showNotifyBanner(`User ${username} banned globally`);
        
        // 5. Clear input
        banUserInput.value = '';
        
    } catch (error) {
        console.error('Ban error:', error);
        showNotifyBanner('Ban error: ' + error.message);
    }
});

unbanBtn.addEventListener('click', async () => {
    if(!isAdmin) return;
    const username = (banUserInput.value||'').trim().toLowerCase();
    if(!username) return showNotifyBanner('Provide username to unban.');
    
    try {
        // 1. Remove from Supabase bans table
        const { error } = await supabase
            .from('bans')
            .delete()
            .eq('username', username);
        
        if (error) {
            showNotifyBanner('Unban failed: ' + error.message);
            return;
        }
        
        // 2. Remove from local ban list
        bannedUsers.delete(username);
        saveLocalState();
        
        // 3. Remove local storage ban flag
        localStorage.removeItem(`device_banned`);
        
        // 4. Send system message
        await sendSystemMessage(`✅ ${username} has been unbanned by ${currentUser.username}`);
        
        // 5. Show notification
        showNotifyBanner(`User ${username} unbanned globally`);
        
        // 6. Clear input
        banUserInput.value = '';
        
    } catch (error) {
        console.error('Unban error:', error);
        showNotifyBanner('Unban error: ' + error.message);
    }
});




</script>
</body>
</html>

